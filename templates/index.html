<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì‹ ì˜ ëˆˆ - GOD DOES NOT BLINK</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="/static/css/style.min.css">
  
  <!-- Three.js and GLTFLoader -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  
  <script>
    // Three.jsê°€ ë¡œë“œëœ í›„ GLTFLoaderë¥¼ ë¡œë“œ
    window.addEventListener('load', () => {
      if (typeof THREE === 'undefined') {
        console.error('Three.jsê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        return;
      }
      
      console.log('Three.js ë¡œë“œ ì™„ë£Œ:', THREE.REVISION);
      
      // Three.jsê°€ ë¡œë“œëœ í›„ GLTFLoader ë¡œë“œ
      const script = document.createElement('script');
      script.src = '/static/js/GLTFLoader.js';
      script.onload = () => {
        console.log('GLTFLoader ë¡œë“œ ì™„ë£Œ');
        
        // GLTFLoaderê°€ ë¡œë“œë˜ë©´ logo5 ë Œë”ëŸ¬ ì´ˆê¸°í™”
        setTimeout(() => {
          if (window.logo5Renderer) {
            console.log('[HTML] logo5 ë Œë”ëŸ¬ ì´ˆê¸°í™” ì‹œì‘');
            window.logo5Renderer.init();
          } else {
            console.log('[HTML] logo5 ë Œë”ëŸ¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ, ìˆ˜ë™ìœ¼ë¡œ ì´ˆê¸°í™”');
            // ìˆ˜ë™ìœ¼ë¡œ ë Œë”ëŸ¬ ìƒì„± ë° ì´ˆê¸°í™”
            if (typeof Logo5Renderer !== 'undefined') {
              window.logo5Renderer = new Logo5Renderer();
              window.logo5Renderer.init();
            }
          }
        }, 500); // 0.5ì´ˆ ëŒ€ê¸°
      };
      script.onerror = () => {
        console.error('GLTFLoader ë¡œë“œ ì‹¤íŒ¨');
      };
      document.head.appendChild(script);
    });
  </script>
  
  <style>
    .drawing-controls {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 30px;
        margin-top: 15px;
    }
    .control-group {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .control-group label {
        font-size: 1rem;
        color: #fff;
    }
    #color-palette {
        display: flex;
        gap: 8px;
    }
    .color-box {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid #fff;
        transition: transform 0.2s;
    }
    .color-box:hover {
        transform: scale(1.1);
    }
    #brush-size {
        cursor: pointer;
    }
    .drawing-mission-container {
        position: relative;
        width: 800px;
        height: 600px;
        border-radius: 10px;
        overflow: hidden;
    }
    .drawing-mission-container canvas {
        position: absolute;
        top: 0;
        left: 0;
    }
    #guide-canvas {
        background-color: white;
        z-index: 1;
    }
    #drawing-canvas {
        background-color: transparent;
        z-index: 2;
    }
    .final-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
    }
    .final-card-container {
        margin: 20px 0;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        border: 3px solid var(--color-glow);
    }
    #final-card-image {
        width: 300px; 
        height: auto;
        display: block;
    }
    .final-message {
        margin-top: 20px;
        font-size: 1.2rem;
        color: var(--color-text-secondary);
    }
    #restart-btn {
        margin-top: 30px;
    }
    
    /* ë³„ìë¦¬ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
    .constellation-info {
        margin-top: 20px;
        text-align: center;
        padding: 15px;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    #constellation-name {
        font-size: 1.4rem;
        font-weight: bold;
        color: #FFD700;
        margin: 0 0 10px 0;
        text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }
    
    #constellation-description {
        font-size: 1rem;
        color: #E0E0E0;
        margin: 0;
        line-height: 1.4;
    }
    
    /* ê°€ì´ë“œ ìº”ë²„ìŠ¤ ìŠ¤íƒ€ì¼ */
    #guide-canvas {
        background: linear-gradient(135deg, #000428 0%, #004e92 100%);
        opacity: 0.7;
    }
    
    /* ë“œë¡œì‰ ìº”ë²„ìŠ¤ ìŠ¤íƒ€ì¼ */
    #drawing-canvas {
        background: transparent;
    }
    
    /* ìµœì¢… ë‹¨ê³„ ë³„ìë¦¬ ìŠ¤íƒ€ì¼ */
    .final-constellation-info {
        margin: 20px 0;
        padding: 20px;
        background: rgba(0, 0, 0, 0.7);
        border-radius: 15px;
        border: 2px solid #FFD700;
    }
    
    .final-constellation-name {
        font-size: 2rem;
        font-weight: bold;
        color: #FFD700;
        margin: 0 0 15px 0;
        text-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
        text-align: center;
    }
    
    .final-constellation-meaning {
        font-size: 1.2rem;
        color: #E0E0E0;
        margin: 0;
        line-height: 1.6;
        text-align: center;
        font-style: italic;
    }
  </style>
</head>
<body>
  <!-- Three.js background -->
  <canvas id="three-canvas"></canvas>

  <!-- Phase 0: ì¸íŠ¸ë¡œ -->
  <section id="intro-section" class="phase-section" tabindex="-1">
    <div class="intro-content">
      <h1 class="intro-title">GOD DOES NOT BLINK</h1>
      <div class="loading-indicator">
        <div class="loading-ring"></div>
        <p>ë‹¹ì‹ ì˜ ë‚´ë©´ì„ ì¤€ë¹„í•˜ëŠ” ì¤‘...</p>
      </div>
    </div>
  </section>

  <!-- Phase 1: í”„ë¡¤ë¡œê·¸ -->
  <section id="prologue-section" class="phase-section" tabindex="-1">
    <div class="prologue-content">
        <h2 class="prologue-title">ë„ˆì˜ ê²°ì •ì— ë§Œì¡±í•˜ëŠ”ê°€...</h2>
        <p class="prologue-subtitle">ë„¤ ë‚´ë©´ì˜ ì§„ì‹¤ì„ ë§ˆì£¼í•  ì¤€ë¹„ê°€ ë˜ì—ˆëŠ”ê°€?</p>
        
        <!-- Three.js 3D ëª¨ë¸ í…ŒìŠ¤íŠ¸ -->
        <div class="three-model-container" style="position: absolute; top: 20px; left: 20px; width: 300px; height: 225px; border-radius: 15px; overflow: hidden; background: transparent; z-index: 10;">
          <canvas id="logo5-canvas" width="300" height="225" style="width: 100%; height: 100%; display: block; background: transparent;"></canvas>
          <div id="three-status" style="text-align: center; color: #00ffff; margin-top: 5px; font-size: 12px;">3D ëª¨ë¸</div>
        </div>
        

        
        <button id="prologue-continue-btn" class="prologue-btn btn">ê³„ì†í•˜ê¸°</button>
    </div>
  </section>

  <!-- Phase 2: ì¹´ë“œ ì„ íƒ -->
  <section id="selection-section" class="phase-section" tabindex="-1">
    <div class="selection-content">
      <h2>ë‹¹ì‹ ì˜ ìš´ëª… ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</h2>
      <div class="card-grid" id="card-grid"><!-- ì¹´ë“œ ë™ì  ìƒì„± --></div>
    </div>
  </section>

  <!-- Phase 3: ë”œë ˆë§ˆì™€ ëŒ€í™” -->
  <section id="dialogue-section" class="phase-section" tabindex="-1">
      <div id="dilemma-container" class="dilemma-container">
          <h2 id="dilemma-title" class="dilemma-title"></h2>
          <div class="dilemma-images">
              <img id="dilemma-left-image" class="dilemma-image" src="" alt="ë”œë ˆë§ˆ ìƒí™© 1">
              <img id="dilemma-right-image" class="dilemma-image" src="" alt="ë”œë ˆë§ˆ ìƒí™© 2">
          </div>
          <div id="mimir-lines" class="mimir-lines"></div>
          <p id="dilemma-guide" class="dilemma-guide"></p>
          <div id="dilemma-choices" class="dilemma-choices">
              <!-- ì„ íƒì§€ ë²„íŠ¼ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
          </div>
      </div>
      <div id="chat-container" class="dialogue-container" style="display: none;">
          <h2 class="dialogue-title">ì‹ ê³¼ì˜ ëŒ€í™”</h2>
          <div id="chat-messages" class="chat-messages"></div>
          <form id="chat-form" class="chat-form">
              <input type="text" id="chat-input" placeholder="ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”..." autocomplete="off">
              <button type="submit">ì „ì†¡</button>
          </form>
          <button id="next-dilemma-btn" class="btn">ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ</button>
      </div>
  </section>

  <!-- Phase 4: ìš´ëª…ì˜ ë³„ìë¦¬ ê·¸ë¦¬ê¸° -->
  <section id="mediapipe-section" class="phase-section" tabindex="-1">
    <div class="mediapipe-main-content">
      <div id="mediapipe-art-view" class="mediapipe-column">
        <h3 class="mediapipe-subtitle">ë‹¹ì‹ ì˜ ì–¼êµ´ì€ ìš°ì£¼ì˜ ë³„ë¹›ì´ ë©ë‹ˆë‹¤.</h3>
        <div class="mediapipe-container">
           <video id="webcam" autoplay playsinline style="display: none;"></video>
           <canvas id="mediapipe-canvas" width="800" height="600"></canvas>
        </div>
      </div>
      <div id="mediapipe-drawing-view" class="mediapipe-column">
        <h3 class="mediapipe-subtitle">ì†ë™ì‘ìœ¼ë¡œ ë‹¹ì‹ ë§Œì˜ ìš´ëª…ì˜ ë³„ìë¦¬ë¥¼ ê·¸ë ¤ë³´ì„¸ìš”.</h3>
        <div class="drawing-mission-container">
            <canvas id="guide-canvas" width="800" height="600"></canvas>
            <canvas id="drawing-canvas" width="800" height="600"></canvas>
        </div>
        <div id="constellation-info" class="constellation-info">
            <p id="constellation-name"></p>
            <p id="constellation-description"></p>
        </div>
      </div>
    </div>
    <div class="constellation-guide">
        <h3 class="guide-title">ğŸ“– ë³„ìë¦¬ ê·¸ë¦¬ê¸° ê°€ì´ë“œ</h3>
        <div class="guide-steps">
            <div class="guide-step active" id="step-1">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>ì›¹ìº  í™œì„±í™”</h4>
                    <p>"ë³„ìë¦¬ ê·¸ë¦¬ê¸° ì‹œì‘" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì›¹ìº ì„ í™œì„±í™”í•˜ì„¸ìš”.</p>
                </div>
            </div>
            <div class="guide-step" id="step-2">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>ë³„ ê·¸ë¦¬ê¸°</h4>
                    <p>ì†ê°€ë½ì„ ì›¹ìº  ì•ì— ëŒ€ê³  ë³„ ëª¨ì–‘ì„ ê·¸ë¦¬ì„¸ìš”. 6ê°œì˜ ë³„ì´ ëª¨ë‘ ê·¸ë ¤ì§ˆ ë•Œê¹Œì§€ ê³„ì†í•˜ì„¸ìš”.</p>
                </div>
            </div>
            <div class="guide-step" id="step-3">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h4>ë³„ ì—°ê²°í•˜ê¸°</h4>
                    <p>ë³„ë“¤ì´ ëª¨ë‘ ê·¸ë ¤ì§€ë©´, ì†ê°€ë½ìœ¼ë¡œ ë³„ê³¼ ë³„ì„ ì‡ëŠ” ì„ ì„ ê·¸ë ¤ë³´ì„¸ìš”.</p>
                </div>
            </div>
            <div class="guide-step" id="step-4">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h4>ì™„ì„±!</h4>
                    <p>ëª¨ë“  ë³„ê³¼ ì—°ê²°ì„ ì´ ê·¸ë ¤ì§€ë©´ ë‹¹ì‹ ë§Œì˜ ìš´ëª…ì˜ ë³„ìë¦¬ê°€ ì™„ì„±ë©ë‹ˆë‹¤!</p>
                </div>
            </div>
        </div>
        <div class="guide-tips">
            <h4>ğŸ’¡ íŒ</h4>
            <ul>
                <li>ì†ê°€ë½ì„ ëª…í™•í•˜ê²Œ ë³´ì´ë„ë¡ ë°ì€ ê³³ì—ì„œ ì§„í–‰í•˜ì„¸ìš”</li>
                <li>ì†ê°€ë½ì„ ì²œì²œíˆ ì›€ì§ì—¬ ì •í™•í•œ ì„ ì„ ê·¸ë¦¬ì„¸ìš”</li>
                <li>ë³„ìë¦¬ê°€ ì™„ì„±ë˜ë©´ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤</li>
            </ul>
        </div>
    </div>
    <div class="mediapipe-controls">
        <button id="start-analysis-btn" class="btn">ë³„ìë¦¬ ê·¸ë¦¬ê¸° ì‹œì‘</button>
        <button id="clear-drawing-btn" class="btn">ë‹¤ì‹œ ê·¸ë¦¬ê¸°</button>
        <p id="analysis-status" class="mediapipe-status">ë²„íŠ¼ì„ ëˆŒëŸ¬ ë³„ìë¦¬ ê·¸ë¦¬ê¸°ë¥¼ ì‹œì‘í•˜ì„¸ìš”.</p>
    </div>
    <p class="mediapipe-description">
        ì›¹ìº ì„ í†µí•´ ë‹¹ì‹ ì˜ ì–¼êµ´ì€ ìš°ì£¼ì˜ ë³„ë¹›ì´ ë˜ê³ , ì†ë™ì‘ì€ ë³„ê³¼ ë³„ì„ ì‡ëŠ” ìš´ëª…ì˜ ì„ ì´ ë©ë‹ˆë‹¤. <br/>
        ë‹¹ì‹ ì˜ ì„ íƒì´ ë§Œë“  ê³ ìœ í•œ ë³„ìë¦¬ë¥¼ ì™„ì„±í•´ë³´ì„¸ìš”.
    </p>
  </section>

  <!-- Phase 4: ìµœì¢… ë‹¨ê³„ -->
  <section id="final-section" class="phase-section" tabindex="-1">
    <div class="final-content">
        <h2 class="final-title">ë‹¹ì‹ ë§Œì˜ ìš´ëª…ì˜ ë³„ìë¦¬ê°€ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤</h2>
        <div class="final-constellation-info">
            <h3 id="final-constellation-name" class="final-constellation-name"></h3>
            <p id="final-constellation-meaning" class="final-constellation-meaning"></p>
        </div>
        <div class="final-card-container">
            <img id="final-card-image" src="" alt="Selected Card" />
        </div>
        <p id="final-message" class="final-message">'íƒ€ë¡œíƒ€ë¡œìŠ¤'íŒ€ì€ ë‹¹ì‹ ì˜ ì—¬ì •ì„ ì˜ì›íˆ ê¸°ì–µí•  ê²ƒì…ë‹ˆë‹¤.</p>
        <button id="restart-btn" class="btn">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
    </div>
  </section>

  <!-- Transition Overlay -->
  <div id="transition-overlay" class="transition-overlay">
      <p id="transition-text"></p>
  </div>

  <!-- Constellation Birth Animation Overlay -->
  <div id="birth-overlay" class="birth-overlay">
      <div class="birth-content">
          <div id="birth-message" class="birth-message"></div>
      </div>
  </div>

  <!-- Card Detail Modal -->
  <div id="card-detail-modal" class="card-detail-modal">
      <div class="card-detail-content">
          <div class="card-detail-header">
              <h2 id="modal-card-name" class="modal-card-name"></h2>
              <span id="modal-card-keyword" class="modal-card-keyword"></span>
              <button class="modal-close-btn" onclick="closeCardDetailModal()">&times;</button>
          </div>
          <div class="card-detail-body">
              <div class="card-detail-section">
                  <h3>ì„±ê²© ë° í–‰ë™ íŒ¨í„´</h3>
                  <p id="modal-card-personality"></p>
              </div>
              <div class="card-detail-section">
                  <h3>ê°•ì </h3>
                  <p id="modal-card-strengths"></p>
              </div>
              <div class="card-detail-section">
                  <h3>ì•½ì </h3>
                  <p id="modal-card-weaknesses"></p>
              </div>
          </div>
          <div class="card-detail-footer">
              <button id="modal-select-card" class="btn select-card-btn">ì´ ì¹´ë“œ ì„ íƒí•˜ê¸°</button>
          </div>
      </div>
  </div>

  <!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ ë° ì•± ì‹œì‘ -->
  <script>
    /**
     * ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ë¡œë“œí•˜ëŠ” í•¨ìˆ˜
     * @param {string} src - ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ ê²½ë¡œ
     * @returns {Promise<void>}
     */
    function loadScript(src) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        script.onload = resolve;
        script.onerror = reject;
        document.head.appendChild(script);
      });
    }

    /**
     * ì• í”Œë¦¬ì¼€ì´ì…˜ ë¶€íŠ¸ìŠ¤íŠ¸ë©: ëª¨ë“  í•„ìˆ˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìˆœì„œëŒ€ë¡œ ë¡œë“œí•˜ê³  ì•±ì„ ì‹œì‘í•©ë‹ˆë‹¤.
     */
    async function bootstrap() {
      try {
        console.log('[HTML] í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì‹œì‘...');
        
        // 1. ì „ì—­ ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬/ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.
        // Three.js (window.THREE) ì™€ API í‚¤ (window.OPENAI_API_KEY ë“±)
        await Promise.all([
          loadScript('https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js'),
          loadScript('/static/js/api_keys.js')
        ]);
        console.log('[HTML] í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì™„ë£Œ.');

        // 2. ì•±ì˜ ë©”ì¸ ëª¨ë“ˆì„ ë™ì ìœ¼ë¡œ importí•©ë‹ˆë‹¤.
        // main.jsê°€ ì˜ì¡´í•˜ëŠ” ë‹¤ë¥¸ ëª¨ë“ˆë“¤(mediapipe ë“±)ì€ JSì˜ import ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
        await import('/static/js/main.js');
        console.log('[HTML] ì• í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë“ˆ ë¡œë”© ì™„ë£Œ. ì•±ì´ ì‹œì‘ë©ë‹ˆë‹¤.');
        
        // Logo5 3D ëª¨ë¸ ë Œë”ëŸ¬ ë¡œë“œ
        await loadScript('/static/js/logo5_renderer.js');
        console.log('[HTML] Logo5 ë Œë”ëŸ¬ ë¡œë”© ì™„ë£Œ.');
        


      } catch (error) {
        console.error('[HTML] ì• í”Œë¦¬ì¼€ì´ì…˜ ë¶€íŠ¸ìŠ¤íŠ¸ë© ì‹¤íŒ¨:', error);
        // ì‚¬ìš©ìì—ê²Œ ë¡œë”© ì‹¤íŒ¨ë¥¼ ì•Œë¦½ë‹ˆë‹¤.
        document.body.innerHTML = '<div style="position:fixed;top:0;left:0;width:100%;height:100%;background:black;color:white;display:flex;align-items:center;justify-content:center;"><h2>ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œë”©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</h2></div>';
      }
    }

    bootstrap();
  </script>

</body>
</html>